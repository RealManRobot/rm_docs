# 运动配置-轨迹指令类

<div style="height: 2px; background-image: linear-gradient(to right, #ccc, #ccc); margin: 1em 0;"></div>

## MoveJ：关节运动

**参数说明：**

| 参数                 | 类型 | 说明                                                         |
| :------------------- | :--- | :----------------------------------------------------------- |
| `movej`              |   `string`   | 关节运动指令。                                                   |
| `joint`              |   `int`   | 目标关节角度，精度0.001°。                                   |
| `v`                  |   `int`   | 速度百分比例系数，0~100。                                      |
| `r`                  |   `int`   | 交融半径，精度0.001m，暂不支持交融，默认0。                    |
| `trajectory_connect` |   `int`   | 可选参数，代表是否和下一条运动一起规划，0代表立即规划，1代表和下一条轨迹一起规划，当为1时，轨迹不会立即执行。 |

**使用示例：**
实现：关节运动，参数如下：

    六自由度关节角度：[10.1°,0.2°,20.3°,30.4°,0.5°,20.6°]；
    七自由度关节角度：[10.1°,0.2°,20.3°,30.4°,0.5°,20.6°,20.6°]；
    速度系数50%；
    交融半径：0。

```json
//六自由度：
{
    "command":"movej",
    "joint":[10100,200,20300,30400,500,20600],
    "v":50,
    "r":0,
    "trajectory_connect":0
}
//七自由度：
{
    "command":"movej",
    "joint":[10100,200,20300,30400,500,20600,20600],
    "v":50,
    "r":0,
    "trajectory_connect":0
}
```

**返回示例：**

```json
{"command":"movej","receive_state":true}
{"state":"current_trajectory_state","trajectory_state":true,"device":0,"trajectory_connect":1}
```

>trajectory_connect：代表是否连接下一条轨迹，0代表全部到位，1代表连接下一条轨迹。

**参数说明：**
| 参数            | 类型   | 说明                                  |
| :-------------- | :----- | :------------------------------------ |
| `receive_state` | `bool` | `ture`：设置成功；`false`：设置失败。 |

## MoveL：直线运动

**参数说明：**

| 参数                 | 类型 | 说明                                                         |
| :------------------- | :--- | :----------------------------------------------------------- |
| `movel`              |   `string`   | 直线运动执行。                                                   |
| `pose`               |   `int`   | 目标位姿，位置精度：0.001mm，姿态精度：0.001rad。            |
| `v`                  |   `int`   | 速度百分比例系数，0~100。                                      |
| `r`                  |   `int`   | 交融半径，精度0.001m，暂不支持交融，默认0。                    |
| `trajectory_connect` |   `int`   | 可选参数，代表是否和下一条运动一起规划，0代表立即规划，1代表和下一条轨迹一起规划，当为1时，轨迹不会立即执行。 |

> 注意：MOVL指令也适用于目标位置不变，姿态变化。

**使用示例：**
实现：直线运动，参数如下：

    目标位置：x：0.1m，y：0.2m，z：0.03m
    目标姿态：rx：0.4rad，ry：0.5rad，rz：0.6rad
    速度系数：50%
    交融半径：不交融。

```json
//六自由度：
{"command":"movel","pose":[100000,200000,30000,400,500,600],"v":50,"r":0,"trajectory_connect":0}
```

**返回示例：**

```json
{"command":"movel","receive_state":true}
//运动到位：
{"state":"current_trajectory_state","trajectory_state":true,"device":0,"trajectory_connect":1}
```

>trajectory_connect：代表是否连接下一条轨迹，0代表全部到位，1代表连接下一条轨迹。

**参数说明：**
| 参数            | 类型   | 说明                                  |
| :-------------- | :----- | :------------------------------------ |
| `receive_state` | `bool` | `ture`：设置成功；`false`：设置失败。 |

## MoveC：圆弧运动

**参数说明：**

| 参数                 | 类型 | 说明                                                         |
| :------------------- | :--- | :----------------------------------------------------------- |
| `movel`              |   `string`   | 直线运动指令。                                                   |
| `pose`               |   `int`   | 目标位姿，位置精度：0.001mm，姿态精度：0.001rad。            |
| `v`                  |   `int`   | 速度百分比例系数，0~100                                      |
| `r`                  |   `int`   | 交融半径，精度0.001m，暂不支持交融，默认0                    |
| `trajectory_connect` |   `int`   | 可选参数，代表是否和下一条运动一起规划，0代表立即规划，1代表和下一条轨迹一起规划，当为1时，轨迹不会立即执行。 |

**使用示例：**
实现：圆弧运动，参数如下：

    中间点位置：x：0.1m，y：0.2m，z：0.03m；
    中间点姿态：rx：0.4rad，ry：0.5rad，rz：0.6rad；
    终点位置：x：0.2m，y：0.3m，z：0.03m；
    终点姿态：rx：0.4rad，ry：0.5rad，rz：0.6rad；
    速度系数：50%；
    交融半径：不交融。

```json
{
    "command":"movec",
    "pose":{
        "pose_via":[100000,200000,30000,400,500,600],
        "pose_to":[200000,300000,30000,400,500,600]
    }
    "v":50,
    "r":0,
    "loop":0,
    "trajectory_connect":0
}
```

**返回示例：**

```json
{"command":"movec","receive_state":true}
//运动到位：
{"state":"current_trajectory_state","trajectory_state":true,"device":0,"trajectory_connect":1}
```

>//trajectory_connect：代表是否连接下一条轨迹，0代表全部到位，1代表连接下一条轨迹。

**参数说明：**

| 参数            | 类型   | 说明                                  |
| :-------------- | :----- | :------------------------------------ |
| `receive_state` | `bool` | `ture`：设置成功；`false`：设置失败。 |

## 角度透传

角度通过CANFD透传给机械臂，不通过控制器规划。

**参数说明：**

| 参数          | 类型 | 说明                                                         |
| :------------ | :--- | :----------------------------------------------------------- |
| `movep_canfd` |   `string`   | 角度透传到CANFD，若指令正确，机械臂立即执行。 |
| `joint` |   `int`   | 关节角度，精度0.001°。 |
| `follow` |   `bool`   | 表示驱动器的运动跟随效果，true为高跟随，false为低跟随。若使用高跟随，透传周期要求不超过10ms。 |
| `expand` |   `int`   | 为下发可选字段，如果存在通用扩展轴，并需要进行透传，可使用此字段进行透传发送。 |

> 备注：
> 1.透传效果和周期、轨迹是否平滑有关，周期要求稳定，防止出现较大波动，基础系列WIFI和网口模式透传周期最快20ms，USB和RS485模式透传周期最快10ms。高速网口的透传周期最快也可到10ms，不过在使用该高速网口前，需要使用指令打开配置。另外I系列有线网口周期最快可达2ms。
>
> 2.用户使用该指令时请做好轨迹规划，轨迹规划的平滑程度决定了机械臂的运行状态，帧与帧之间关节的角度最大不能超过10°，并保证关节规划的速度不要超过180°/s，否则关节会不响应。

**使用示例：**
实现：目标角度透传到机械臂CANFD，参数如下：

    六自由度机械臂目标关节角度：[1°,0°,20°,30°,0°,20°]；
    七自由度机械臂目标关节角度：[1°,0°,20°,30°,0°,20°,20°]。

```json
//六自由度
{"command":"movej_canfd","joint":[1000,0,20000,30000,0,20000],"follow":true,"expand":1000}
//七自由度
{"command":"movej_canfd","joint":[1000,0,20000,30000,0,20000,20000],"follow":true,"expand":1000}
```

**返回示例：**

```json
//六自由度：
{"state":"joint_state","joint":[10,20,30,40,50,60], "arm_err":0}
//七自由度：
{"state":"joint_state","joint":[10,20,30,40,50,60,70], "arm_err":0}
```

**参数说明：**
| 参数      | 类型     | 说明       |
| :-------- | :------- | :--------- |
| `arm_err` | `number` | 状态码。若为0，则代表系统正常，指令正常运行；若为其他错误，则反馈相应错误代码，指令不执行  |

## 位姿透传

目标位姿透传给机械臂CANFD，不通过控制器规划。目标位姿为当前工具在当前工作和工具坐标系下的数值。

**参数说明：**

| 参数          | 类型 | 说明                                                         |
| :------------ | :--- | :----------------------------------------------------------- |
| `movej_canfd` |   `string`   | 角度透传到CANFD，若指令正确，机械臂立即执行joint：关节角度，精度0.001°。 |
| `pose` |   `int`   | 目标位姿。位置精度：0.001mm，姿态精度：0.001rad。 |
| `follow` |   `bool`   | 表示驱动器的运动跟随效果，true为高跟随，false为低跟随。若使用高跟随，透传周期要求不超过10ms。 |

> 注意：透传效果和周期、轨迹是否平滑有关，周期要求稳定，防止出现较大波动，基础系列WIFI和网口模式透传周期最快20ms，USB和RS485模式透传周期最快10ms。高速网口的透传周期最快也可到10ms，不过在使用该高速网口前，需要使用指令打开配置。另外I系列有线网口周期最快可达2ms。
>
> 用户使用该指令时请做好轨迹规划，轨迹规划的平滑程度决定了机械臂的运行状态，帧与帧之间关节的角度最大不能超过10°，并保证关节规划的速度不要超过180°/s，否则关节会不响应。

**使用示例：**
实现：目标位姿透传，参数如下：

    目标位置：x：0.1m，y:0.2m，z：0.03m；
    目标姿态（欧拉角）：rx：0.4rad，ry：0.5rad，rz：0.6rad；
    目标姿态（四元数）：w：0.4，x：0.5，y：0.6，z：0.7。

**使用示例：**
```json
//位姿透传欧拉角方式
{"command":"movep_canfd","pose":[100000,200000,30000,400,500,600],"follow":true}
//位姿透传四元数方式
{"command":"movep_canfd","pose_quat":[100000,200000,30000,400000,500000,600000,700000],"follow":true}
```

**返回示例：**

```json
//六自由度：
{"state":"pose_state","pose":[10,20,30,40,50,60],"joint":[10,20,30,40,50,60], "arm_err":0}
//七自由度：
{"state":"pose_state","pose":[10,20,30,40,50,60],"joint":[10,20,30,40,50,60,70], "arm_err":0}
//pose：当前位姿，位置精度：0.001mm，姿态精度：0.001rad；joint：当前关节角度，关节精度：0.001°；arm_err：
```

| 参数      | 类型     | 说明     |
| :-------- | :------- | :------- |
| `pose`   | `array`  | 当前位姿，位置精度：0.001mm，姿态精度：0.001rad。   |
| `joint`   | `array`  | 当前关节角度，关节精度：0.001°。   |
| `arm_err` | `number` | 状态码。若为0，则代表系统正常，指令正常运行；若为其他错误，则反馈相应错误代码，指令不执行。|
>需要注意的是I系列机械臂不再提供返回值，通过UDP状态主动上报接口采集机械臂实时状态。

## MoveJ_P：关节空间规划到目标位姿

通过关节空间规划运动到目标位姿。

**参数说明：**

| 参数          | 类型 | 说明                                                         |
| :------------ | :--- | :----------------------------------------------------------- |
| `movej_p` |   `string`   | 关节空间规划到目标位姿指令。 |
| `pose` |   `int`   | 目标位姿，位置精度：0.001mm，姿态精度：0.001rad。 |
| `v` |   `int`   | 速度百分比例系数，0~100。 |
| `r` |   `int`   | 交融半径，精度0.001m，暂不支持交融，默认0。 |
| `trajectory_connect` |   `int`   | 可选参数，代表是否和下一条运动一起规划，0代表立即规划，1代表和下一条轨迹一起规划，当为1时，轨迹不会立即执行。 |

**使用示例：**
实现：直线运动，运动参数如下：

    目标位置：x：0.1m，y：0.2m，z：0.03m；
    目标姿态：rx：0.4rad，ry：0.5rad，rz：0.6rad；
    速度系数：50%；
    交融半径：不交融。

```json
{"command":"movej_p","pose":[100000,200000,30000,400,500,600],"v":50,"r":0,"trajectory_connect":0}
```

**返回示例：**

```json
//返回指令接收状态：
{"command":"movej_p","receive_state":true}
//运动到位：
{"state":"current_trajectory_state","trajectory_state":true,"device":0,"trajectory_connect":1}
//trajectory_connect：代表是否连接下一条轨迹，0代表全部到位，1代表连接下一条轨迹
```

| 参数            | 类型   | 说明                                  |
| :-------------- | :----- | :------------------------------------ |
| `receive_state` | `bool` | `ture`：设置成功；`false`：设置失败。 |

## MoveS：样条曲线运动

样条曲线运动是一种通过控制点（也称为节点或关键点）定义的平滑曲线运动轨迹。为了实现样条曲线运动，需要至少三个不同的型值点才能完成控制点反算，连续使用moves指令来输入这些型值点。

**参数说明：**

| 参数                 | 类型 | 说明                                                         |
| :------------------- | :--- | :----------------------------------------------------------- |
| `moves`              |   `string`   | 样条曲线运动指令。                                                 |
| `pose`               |   `int`   | 目标位姿，位置精度：0.001mm，姿态精度：0.001rad。              |
| `v`                  |   `int`   | 速度百分比例系数，0~100。                                      |
| `r`                  |   `int`   | 交融半径，精度0.001m，暂不支持交融，默认0。                    |
| `trajectory_connect` |   `int`   | 可选参数，代表是否和下一条运动一起规划，0代表立即规划，1代表和下一条轨迹一起规划，当为1时，轨迹不会立即执行。 |

**使用示例：**
实现：发三个点实现一条样条曲线运动，参数如下：

    目标位置：
    x：0.1m，y：0.2m，z：0.03m；
    x：0.1m，y：0.3m，z：0.03m；
    x：0.1m，y：0.4m，z：0.03m；
    目标姿态：rx：0.4rad，ry：0.5rad，rz：0.6rad；
    速度系数：50%；
    交融半径：不交融。

```json
{"command":"moves","pose":[100000,200000,30000,400,500,600],"v":50,"r":0,"trajectory_connect":1}
{"command":"moves","pose":[100000,300000,30000,400,500,600],"v":50,"r":0,"trajectory_connect":1}
{"command":"moves","pose":[100000,400000,30000,400,500,600],"v":50,"r":0,"trajectory_connect":0}
```

**返回示例：**

```json
//返回指令接收状态：
{"command":"moves","receive_state":true} 
//运动到位：
{"state":"current_trajectory_state","trajectory_state":true,"device":0,"trajectory_connect":1}
```

>trajectory_connect：代表是否连接下一条轨迹，0代表全部到位，1代表连接下一条轨迹。

**参数说明：**
| 参数            | 类型   | 说明                                  |
| :-------------- | :----- | :------------------------------------ |
| `receive_state` | `bool` | `ture`：设置成功；`false`：设置失败。 |
