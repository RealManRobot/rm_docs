
# 透传力位混合控制补偿（选配）

针对睿尔曼带一维力和六维力版本的机械臂，用户除了可直接使用示教器调用底层的力位混合控制模块外，还可以将自定义的轨迹以周期性透传的形式结合底层的力位混合控制算法进行补偿。

## （1）开启透传力位混合控制补偿模式

| 功能描述 | 开启底层力位混合控制模块补偿模式。在下发透传轨迹前必须下发该指令开启功能 |
| :--- | :----------------------------------- |
| 参数说明 | `Start_Force_Position_Move`          |
| 命令格式 | {s\:s}                               |

**使用示例：**
说明：

```json
{"command":"Start_Force_Position_Move"}
```

**返回示例：**

```json
{"command":"Start_Force_Position_Move","set_state":true}
True：设置成功，可进行后续透传。False：设置失败，机械臂有错误，不可进行后续透传
```

## （2）Force\_Position\_Move：透传力位混合补偿\*\*

| 功能描述 | `Force_Position_Move`：用户周期性下发目标角度或者目标位姿，使用机械臂底层力位混合控制模块通过一维力传感器或者六维力传感器实现力位补偿。 |
| :--- | :----------------------------------------------------------------------------- |
| 参数说明 | `Force_Position_Move`：透传力位混合补偿                                                 |
| 命令格式 | 六自由度机械臂关节角度方式或位姿（姿态欧拉角）方式{s\:s,s:\[i,i,i,i,i,i],s\:i,s\:i,s\:i,s\:i,s\:b}      |

**使用示例：**
说明：

```json
位姿（姿态欧拉角）方式
{"command":"Force_Position_Move","pose":[100000,200000,30000,400,500,600],"sensor":0,"mode":0,"dir":0, "force":15,"follow":true}
位姿（姿态四元数）方式
{"command":"Force_Position_Move","pose_quat":[100000,200000,30000,400000,500000,600000,700000],"sensor":0,"mode":0,"dir":0, "force":15,"follow":true}
说明：透传目标位姿进行力位混合控制补偿
目标位置（欧拉角方式）：x：0.1m，y:0.2m，z：0.03m，Rx：0.4rad， Ry：0.5rad，Rz：0.6rad
目标位置（四元数方式）：x：0.1m，y:0.2m，z：0.03m，w：0.4， x：0.5，y：0.6，z：0.7
使用一维力沿工作坐标系进行Z方向补偿，力控为Fz：1.5N
{"command":"Force_Position_Move","joint":[1000,2000,3000,4000,5000,6000],"sensor":0,"mode":0, "dir":0, "force":15}
说明：透传目标角度进行力位混合控制补偿
关节1~6目标角度：1°，2°，3°，4°，5°，6°
使用一维力沿工作坐标系进行Z方向补偿，力控为Fz：1.5N
```

**返回示例：**

```json
规划成功——返回当前各关节角度和所使用力控方式的力或力矩，如果使用的是六维力，则也会返回全部方向上的力和力矩 
{s:s,s:[i,i,i,i,i,i],s:i, s:i}或{s:s, s:[i,i,i,i,i,i], s:i, s:[i,i,i,i,i,i], s:i}
一维力：
{"state":"Force_Position_State","joint":[10,20,30,40,50,60],"force":-15, "arm_err":0}当前关节1~6角度为0.01°~0.06°，所受到的力或力矩为-1.5
六维力：
{"state":"Force_Position_State","joint":[10,20,30,40,50,60],"force":-15, "all_direction_force":[11,21,-15,41,51,61],"arm_err":0}当前关节1~6角度为0.01°~0.06°，力控方向所受到的力或力矩为-1.5N，所有方向的力或力矩为X：1.1N，Y：2.1N，Z：-1.5N，Rx：4.1Nm，Ry：5.1Nm，Rz：6.1Nm
需要注意的是I系列机械臂不再提供返回值，可通过UDP状态主动上报接口采集机械臂实时状态。
{"command":"Force_Position_Move", "set_state":false}
```

## （3）关闭透传力位混合控制补偿模式

| 功能描述 | 关闭底层力位混合控制模块补偿模式。在完成透传轨迹后必须下发该指令关闭功能 |
| :--- | :----------------------------------- |
| 参数说明 | `Stop_Force_Position_Move`           |
| 命令格式 | {s\:s}                               |

**使用示例：**
说明：

```json
{"command":"Stop_Force_Position_Move"}
```

**返回示例：**

```json
{"command":"Stop_Force_Position_Move","set_state":true}
```
